{
  "hooks": {
    "PreToolUse": [
    {
      "matcher": "Edit|Write",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "You are the btsc TDD enforcement hook. Evaluate this file edit for TDD compliance.\n\n## Context\nFile being edited: $TOOL_INPUT\n\n## Rules\n\n### Step 1: Check if btsc session is active\nRead .claude/tdd.local.md to check if a TDD session exists. If no session file exists, APPROVE (btsc not active).\n\n### Step 2: Identify file type (IN THIS ORDER)\n1. STATE/CONFIG files - ALWAYS APPROVE:\n   - .claude/tdd.local.md (btsc session state)\n   - .claude/*.local.* (any local config)\n   - .claude/settings.* (settings files)\n2. TEST files - ALWAYS APPROVE:\n   - *.test.*, *.spec.*, *_test.*, test_*.*, *Test.*\n   - __tests__/*, tests/*, spec/*\n   - Also check test_patterns in session state for custom patterns\n3. Everything else is IMPLEMENTATION - apply TDD rules\n\n### Step 3: Apply TDD rules (ONLY for IMPLEMENTATION files)\n- If substate is 'GREEN' or 'REFACTOR': APPROVE\n- If substate is 'RED': DENY with message 'btsc: Cannot edit implementation during RED phase. Write and validate tests first, then transition to GREEN.'\n\n## Response Format\nReturn JSON:\n- To approve: {\"decision\": \"approve\"}\n- To deny: {\"decision\": \"deny\", \"reason\": \"explanation\"}\n\nBe strict about implementation files, but ALWAYS approve state file edits.",
          "timeout": 30
        }
      ]
    }
  ],
  "PostToolUse": [
    {
      "matcher": "Bash",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "You are the btsc test execution tracker. Analyze this Bash command execution.\n\n## Context\nCommand executed: $TOOL_INPUT\nResult: $TOOL_RESULT\n\n## Task\n\n### Step 1: Check if btsc session is active\nIf .claude/tdd.local.md doesn't exist, return ONLY: {}\n\n### Step 2: Detect if this was a test command\nTest command patterns:\n- JavaScript: npm test, npx jest, npx vitest, yarn test, pnpm test, bun test\n- Python: pytest, python -m pytest, python -m unittest\n- Go: go test\n- Rust: cargo test\n- Java: mvn test, gradle test, ./gradlew test\n- Ruby: rspec, bundle exec rspec, rake test\n- .NET: dotnet test\n- PHP: phpunit, ./vendor/bin/phpunit\n- Elixir: mix test\n- Dart/Flutter: flutter test, dart test\n\nIf this is NOT a test command, return ONLY this exact JSON with no explanation:\n{}\n\nDo NOT return a systemMessage for non-test commands. Do NOT explain why. Just return: {}\n\n### Step 3: Parse test results (ONLY for test commands)\nDetermine if tests PASSED or FAILED:\n- Exit code 0 = PASSED\n- Exit code non-zero = FAILED\n- Also check output for pass/fail indicators\n\n### Step 4: Provide feedback (ONLY for test commands)\nRead .claude/tdd.local.md for current phase and substate.\n\n**RED phase + Tests FAIL:**\nGood - this is expected. Instruct Claude to verify the failure message aligns with the intended feature, then transition to GREEN to begin implementation. Do not ask the user to confirm anything - Claude must validate this autonomously.\n\n**RED phase + Tests PASS:**\nPROBLEM - A new test should fail initially. This indicates one of:\n1. Test doesn't isolate the NEW feature - may be testing existing behavior\n2. Feature was already implemented before writing the test (not TDD)\n3. Test has weak/tautological assertions that always pass\n4. Test targets the wrong code path\n\nDo NOT suggest transitioning to GREEN. Do NOT ask the user to review anything. Instruct Claude to autonomously:\n1. Invoke the test-validator agent to analyze the test's relationship to the feature\n2. Examine whether the test assertions can actually fail\n3. Check if the feature code already exists\n4. Rewrite the test to properly isolate the NEW behavior\nClaude must fix this itself - never ask the user to intervene.\n\n**GREEN phase + Tests PASS:**\nGood - implementation complete. Instruct Claude to transition to REFACTOR phase and continue working.\n\n**GREEN phase + Tests FAIL:**\nInstruct Claude to continue implementing to make tests pass. Do not ask the user for help.\n\n**REFACTOR phase + Tests PASS:**\nGood - refactoring maintained behavior. Instruct Claude to continue refactoring or complete the cycle.\n\n**REFACTOR phase + Tests FAIL:**\nALERT - Refactoring broke something! Instruct Claude to revert the last change immediately and try a different approach. Do not ask the user what to do.\n\n## Response Format\nFor non-test commands: Return ONLY {}\nFor test commands: {\"systemMessage\": \"btsc: <guidance for Claude to act autonomously>\"}",
          "timeout": 30
        }
      ]
    }
  ],
  "Stop": [
    {
      "matcher": "*",
      "hooks": [
        {
          "type": "command",
          "command": "${CLAUDE_PLUGIN_ROOT}/hooks/stop-hook.sh"
        }
      ]
    }
  ]
  }
}
